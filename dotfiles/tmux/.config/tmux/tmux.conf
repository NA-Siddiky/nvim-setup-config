# ====================
# Tmux Configuration
# ====================

# Terminal & Undercurl
set -g default-terminal "${TERM}"
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# Indexing
set -g base-index 1
set -g pane-base-index 1

# Prefix
unbind C-b
set -g prefix C-a
set -g prefix2 none

# Reload config
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display "Tmux config reloaded"

# Splits (path preserved)
unbind %
unbind '"'
bind - split-window -v -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"

# Copy Mode (vi)
unbind v
bind v copy-mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection
setw -g mode-keys vi
unbind -T copy-mode-vi MouseDragEnd1Pane

# Resize
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5
bind -r z resize-pane -Z

# Mouse toggle
bind m set -g mouse \; display "Mouse: #{?mouse,ON,OFF}"

# Session
bind -r @ kill-session
bind n command-prompt -p "new-session -s '%%'"

# ====================
# Nord Colors (Blue Variant)
# ====================
set -g @thm_bg "#2E3440"         # nord0
set -g @thm_fg "#ECEFF4"         # nord6
set -g @thm_blue "#81A1C1"       # nord9
set -g @thm_blue_alt "#5E81AC"   # nord10
set -g @thm_blue_glow "#88C0D0"  # brighter blue for highlights/glow
set -g @thm_gray "#4C566A"       # nord3
set -g @thm_darkgray "#3B4252"   # nord1


# ====================
# Status Bar
# ====================
set -g status on
set -g status-interval 2
set -g status-justify centre
set -g status-left-length 40
set -g status-right-length 100
set -g status-position bottom
set -g status-style "bg=#{#434C5E},fg=#{@thm_fg}"

set -g window-status-format " #I:#W "
set -g window-status-current-format " #I:#W "
set -g window-status-style "fg=#A6ACCD,bg=#434C5E"
set -g window-status-current-style "fg=#2E3440,bg=#88C0D0"

set -g status-left "#[bg=#{@thm_blue},fg=#{@thm_bg}]  #(basename \"#S\") #[default] #[fg=#{@thm_blue_glow}]#{nowplaying}"

# set -g status-right "#[fg=#{@thm_blue}] #(basename \"#{pane_current_command}\") #[fg=#{@thm_blue_alt}]|   #{cpu_percentage} #[fg=#{@thm_blue_alt}]|   #(uptime | awk '{print $3, $4}' | tr -d ',') #[fg=#{@thm_blue}]|   #{battery_percentage} "
set -g status-right "#[fg=#{@thm_blue}] #(basename \"#{pane_current_command}\") #[fg=#{@thm_blue_alt}]|   #(uptime | awk '{print $3, $4}' | tr -d ',') #[fg=#{@thm_blue}]"

# ====================
# Popups (Floating Nord Panels)
# ====================
bind-key -n M-p display-popup -d '#{pane_current_path}' -w 80% -h 60%
bind-key -n M-n display-popup -w60% -h20% -E "/bin/bash -c 'read -p \"Note: \" note && $HOME/Documents/Coding/Projects/setthemacup/scripts/note.sh \"\$note\"'"

# ====================
# TPM Plugins
# ====================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'barlevalon/tmux-nowplaying'
run '~/.config/tmux/plugins/tpm/tpm'
